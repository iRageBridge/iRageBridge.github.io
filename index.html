<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Retrieve Task</title>
<link rel="shortcut icon" href="images/task.png" alt="tab Icon">
<link type="text/css" rel="stylesheet" href="css/bootstrap.css"/>
<body id="mainBody">
<div class="navbar navbar-default navbar-fixed-top" style="width: 300px; margin-left:auto; margin-right:auto;">
	<div class="container" id="tableCenter">
  		<div class="navbar-header">
          	<a href="index.html" class="navbar-brand">Task Manager</a><br/><br/>
        </div>
    </div>
</div>

<br/><br/><br/><br/>
<div id="border" class="input-group">
	<span class="input-group-addon" id="basic-addon-1"></span>
	<br/><br/>Enter Task Decription Here:<br/><input type="text" id="descInput" class="form-control" placeholder="Description" aria-describedby="basic-addon-1"><br/><br/>
	Enter Task Priority Here:<br/><input type="number" id="priorInput" value=1 class="form-control" placeholder="Priority" aria-describedby="basic-addon-1"><br/><br/>
	Enter Task Due Date Here:<br/><input type="date" id="dateInput" class="form-control" placeholder="Due Date" aria-describedby="basic-addon-1"><br/><br/>
    <br/><a href="index.html"><button id="enter" href="index.html" class="btn btn-default">Add Task</button></a>
</div>

<script>
 	var info=document.createElement("h3");
    info.innerHTML="(Click on the table headings to sort columns)";
	var mainBody=document.getElementById("mainBody");
	var peopleTable=document.createElement("table");
	peopleTable.setAttribute("id", "tableDesign");
    peopleTable.setAttribute("class", "table");
	var tableBody=document.createElement("tbody");
	var heading=document.createElement("tr");
	var id=document.createElement("th");
	id.setAttribute("id", "sortID");
	var desc=document.createElement("th");
	desc.setAttribute("id", "sortDescription");
	var prior=document.createElement("th");
	prior.setAttribute("id", "sortPriority");
	var due=document.createElement("th");
	due.setAttribute("id", "sortDate");
	var del=document.createElement("th");
	id.innerHTML="ID";
	desc.innerHTML="Description";
	prior.innerHTML="Priority";
	due.innerHTML="Due Date";
	del.innerHTML="Delete?"; 
    var info=document.createElement("h3");
	info.innerHTML="(Click on the table headings to sort columns)";
	var tasks=[];
	var mainBody=document.getElementById("mainBody");
	
	document.getElementById("enter").onclick= function(){
		var keyinput= "myTask";    
        if(descInput.value != ""){
            var randomNumber = (Math.random() * 10) + 1;
			randomNumber=Math.round(randomNumber);
            var task={
				id: randomNumber,
				description: document.getElementById("descInput").value,
				priority: document.getElementById("priorInput").value,
				dueDate: document.getElementById("dateInput").value.toString(),
            };
			tasks.push(task);
                
            if(typeof(window.localStorage)!="undefined"){
                window.localStorage.setItem(keyinput,JSON.stringify(tasks));	
		    }
			
		    else{
			    alert("window.localStorage, not defined");
		    }
        }
        
        else{
            alert("ERROR! Please Enter a Task Description");
        }
	}
    
    var tasks = JSON.parse(localStorage.getItem("myTask"));
    function printTable(){
        mainBody.appendChild(info);
        clearTable();
        mainBody.appendChild(peopleTable);
        peopleTable.appendChild(tableBody);
        tableBody.appendChild(heading);
        heading.appendChild(id);
        heading.appendChild(desc);
        heading.appendChild(prior);
        heading.appendChild(due);
        heading.appendChild(del);
        for(var i = 0; i < tasks.length; i++){
			var newRow=document.createElement("tr");
			
			var taskID=document.createElement("td");
			taskID.innerHTML=tasks[i].id;
			newRow.appendChild(taskID);
				
			var taskDescription=document.createElement("td");
			taskDescription.innerHTML=tasks[i].description;
			newRow.appendChild(taskDescription);
					
			var taskPriority=document.createElement("td");
			taskPriority.innerHTML=tasks[i].priority;
			newRow.appendChild(taskPriority);
				
			var taskDueDate=document.createElement("td");
			taskDueDate.innerHTML=tasks[i].dueDate;
			newRow.appendChild(taskDueDate);
					
			var deleteRowButton=document.createElement("button");
			deleteRowButton.setAttribute("id", "deleteButton");
            deleteRowButton.setAttribute("class", "btn btn-default btn-lg");
            deleteRowButton.setAttribute("data-toggle", "modal");
            deleteRowButton.setAttribute("data-target", "#myModal");
            deleteRowButton.setAttribute("value", "delete");
			deleteRowButton.innerHTML="Delete";
				
			var deleteRow=document.createElement("td");
			deleteRow.appendChild(deleteRowButton);
			newRow.appendChild(deleteRow);
			peopleTable.appendChild(newRow);						
			
			deleteRowButton.onclick=function(){
                alert("CAUTION! TASK WILL BE DELETED");
				var j = this.parentNode.parentNode.rowIndex;
				peopleTable.deleteRow(j-1);
				tasks.splice(j-1,1);
				window.localStorage.clear()(tasks);
				clearTable();
				printTable();
			}
		}		
	}
	
	function clearTable(){
		peopleTable.innerHTML="";
    }
    
    window.onload = printTable;
    function printTable(){
        mainBody.appendChild(info);
        clearTable();
        mainBody.appendChild(peopleTable);
        peopleTable.appendChild(tableBody);
        tableBody.appendChild(heading);
        heading.appendChild(id);
        heading.appendChild(desc);
        heading.appendChild(prior);
        heading.appendChild(due);
        heading.appendChild(del);
        for(var i = 0; i < tasks.length; i++){
            var newRow=document.createElement("tr"); 
			var taskID=document.createElement("td");
			taskID.innerHTML=tasks[i].id;
			newRow.appendChild(taskID);
				    
			var taskDescription=document.createElement("td");
			taskDescription.innerHTML=tasks[i].description;
			newRow.appendChild(taskDescription);
					
			var taskPriority=document.createElement("td");
			taskPriority.innerHTML=tasks[i].priority;
			newRow.appendChild(taskPriority);
				
			var taskDueDate=document.createElement("td");
			taskDueDate.innerHTML=tasks[i].dueDate;
			newRow.appendChild(taskDueDate);
					
			var deleteRowButton=document.createElement("button");
			deleteRowButton.setAttribute("id", "deleteButton");
			deleteRowButton.setAttribute("class", "btn btn-default");
			deleteRowButton.innerHTML="Delete";
				    
			var deleteRow=document.createElement("td");
			deleteRow.appendChild(deleteRowButton);
			newRow.appendChild(deleteRow);
			peopleTable.appendChild(newRow);						
			 
            deleteRowButton.onclick=function(){
				var j = this.parentNode.parentNode.rowIndex;
                peopleTable.deleteRow(j-1);
				tasks.splice(j-1,1);
                clearTable();
				printTable();
			}
    	}		
    }
    
    desc.onclick=function(){
        tasks.sort(function(a,b){
            var nameA=a.description.toLowerCase();
            var nameB=b.description.toLowerCase();
		
            if (nameA < nameB){
				return -1;
            }
			
            if (nameA > nameB){
                return 1;
            }
			
            else{
                return 0;
            }
        })
		
        clearTable();
        printTable();
    }
	
    id.onclick=function(){
        tasks.sort(sortAgeFunction)
		
        function sortAgeFunction(a,b){
            return a.id-b.id;
        }
		
        clearTable();
        printTable();
    }
	
    prior.onclick=function(){
        tasks.sort(sortPriorFunction)
		
        function sortPriorFunction(a,b){
			
            return a.priority-b.priority;
        }
		
        clearTable();
        printTable();
    }
		
    due.onclick=function(){
        tasks.sort(function(a,b){
            var nameA=a.description.toLowerCase();
            var nameB=b.description.toLowerCase();
		
            if (nameA < nameB){
				return -1;
            }
			
            if (nameA > nameB){
                return 1;
            }
			
            else{
                return 0;
            }
        })
		
        clearTable();
        printTable();
    }
</script>
<script src="js/jQuery.js"></script>
<script src="js/bootstrap.js"></script>
</body>
</html>